<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>JClic.js Source: automation/arith/Arith.js</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.united.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">JClic.js</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="module-JClic.html">JClic</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="AbstractBox.html">AbstractBox</a></li><li><a href="Action.html">Action</a></li><li><a href="ActionReg.html">ActionReg</a></li><li><a href="ActiveBagContent.html">ActiveBagContent</a></li><li><a href="ActiveBox.html">ActiveBox</a></li><li><a href="ActiveBoxBag.html">ActiveBoxBag</a></li><li><a href="ActiveBoxContent.html">ActiveBoxContent</a></li><li><a href="ActiveBoxGrid.html">ActiveBoxGrid</a></li><li><a href="ActiveMediaBag.html">ActiveMediaBag</a></li><li><a href="ActiveMediaPlayer.html">ActiveMediaPlayer</a></li><li><a href="Activity.html">Activity</a></li><li><a href="ActivityPanel.html">ActivityPanel</a></li><li><a href="ActivityReg.html">ActivityReg</a></li><li><a href="ActivitySequence.html">ActivitySequence</a></li><li><a href="ActivitySequenceElement.html">ActivitySequenceElement</a></li><li><a href="ActivitySequenceJump.html">ActivitySequenceJump</a></li><li><a href="Arith.html">Arith</a></li><li><a href="Arith.Operator.html">Arith.Operator</a></li><li><a href="AudioBuffer.html">AudioBuffer</a></li><li><a href="AutoContentProvider.html">AutoContentProvider</a></li><li><a href="AutoContentProvider.ActiveBagContentKit.html">AutoContentProvider.ActiveBagContentKit</a></li><li><a href="BasicEvaluator.html">BasicEvaluator</a></li><li><a href="BlueSkin.html">BlueSkin</a></li><li><a href="BoxBag.html">BoxBag</a></li><li><a href="BoxBase.html">BoxBase</a></li><li><a href="BoxConnector.html">BoxConnector</a></li><li><a href="ClassicJigSaw.html">ClassicJigSaw</a></li><li><a href="Complete.html">Complete</a></li><li><a href="CompletePanel.html">CompletePanel</a></li><li><a href="ComplexAssociation.html">ComplexAssociation</a></li><li><a href="ComplexAssociationPanel.html">ComplexAssociationPanel</a></li><li><a href="ComplexEvaluator.html">ComplexEvaluator</a></li><li><a href="ConditionalJumpInfo.html">ConditionalJumpInfo</a></li><li><a href="Container.html">Container</a></li><li><a href="Counter.html">Counter</a></li><li><a href="CrossWord.html">CrossWord</a></li><li><a href="CrossWordPanel.html">CrossWordPanel</a></li><li><a href="CustomSkin.html">CustomSkin</a></li><li><a href="DefaultSkin.html">DefaultSkin</a></li><li><a href="Dimension.html">Dimension</a></li><li><a href="DoublePuzzle.html">DoublePuzzle</a></li><li><a href="DoublePuzzlePanel.html">DoublePuzzlePanel</a></li><li><a href="Ellipse.html">Ellipse</a></li><li><a href="EmptySkin.html">EmptySkin</a></li><li><a href="Encryption.html">Encryption</a></li><li><a href="Evaluator.html">Evaluator</a></li><li><a href="EventSounds.html">EventSounds</a></li><li><a href="EventSoundsElement.html">EventSoundsElement</a></li><li><a href="ExchangePuzzle.html">ExchangePuzzle</a></li><li><a href="ExchangePuzzlePanel.html">ExchangePuzzlePanel</a></li><li><a href="Explore.html">Explore</a></li><li><a href="ExplorePanel.html">ExplorePanel</a></li><li><a href="FillInBlanks.html">FillInBlanks</a></li><li><a href="FillInBlanksPanel.html">FillInBlanksPanel</a></li><li><a href="Font.html">Font</a></li><li><a href="Gradient.html">Gradient</a></li><li><a href="GreenSkin.html">GreenSkin</a></li><li><a href="HolePuzzle.html">HolePuzzle</a></li><li><a href="HolePuzzlePanel.html">HolePuzzlePanel</a></li><li><a href="Holes.html">Holes</a></li><li><a href="Identify.html">Identify</a></li><li><a href="IdentifyPanel.html">IdentifyPanel</a></li><li><a href="IdentifyText.html">IdentifyText</a></li><li><a href="IdentifyTextPanel.html">IdentifyTextPanel</a></li><li><a href="InformationScreen.html">InformationScreen</a></li><li><a href="InformationScreenPanel.html">InformationScreenPanel</a></li><li><a href="JClicPlayer.html">JClicPlayer</a></li><li><a href="JClicProject.html">JClicProject</a></li><li><a href="JigSaw.html">JigSaw</a></li><li><a href="JumpInfo.html">JumpInfo</a></li><li><a href="MediaBag.html">MediaBag</a></li><li><a href="MediaBagElement.html">MediaBagElement</a></li><li><a href="MediaContent.html">MediaContent</a></li><li><a href="MemoryGame.html">MemoryGame</a></li><li><a href="MemoryGamePanel.html">MemoryGamePanel</a></li><li><a href="Menu.html">Menu</a></li><li><a href="MenuPanel.html">MenuPanel</a></li><li><a href="MiniSkin.html">MiniSkin</a></li><li><a href="OrangeSkin.html">OrangeSkin</a></li><li><a href="OrderText.html">OrderText</a></li><li><a href="OrderTextPanel.html">OrderTextPanel</a></li><li><a href="Path.html">Path</a></li><li><a href="PathStroke.html">PathStroke</a></li><li><a href="PlayerHistory.html">PlayerHistory</a></li><li><a href="PlayerHistory_HistoryElement.html">PlayerHistory#HistoryElement</a></li><li><a href="Point.html">Point</a></li><li><a href="ProjectSettings.html">ProjectSettings</a></li><li><a href="Rectangle.html">Rectangle</a></li><li><a href="Rectangular.html">Rectangular</a></li><li><a href="ReportBean.html">ReportBean</a></li><li><a href="Reporter.html">Reporter</a></li><li><a href="ReporterInfo.html">ReporterInfo</a></li><li><a href="SCORM.html">SCORM</a></li><li><a href="SequenceReg.html">SequenceReg</a></li><li><a href="SequenceRegInfo.html">SequenceRegInfo</a></li><li><a href="SessionReg.html">SessionReg</a></li><li><a href="SessionRegInfo.html">SessionRegInfo</a></li><li><a href="SessionStorageReporter.html">SessionStorageReporter</a></li><li><a href="Shape.html">Shape</a></li><li><a href="Shaper.html">Shaper</a></li><li><a href="SimpleAssociation.html">SimpleAssociation</a></li><li><a href="SimpleAssociationPanel.html">SimpleAssociationPanel</a></li><li><a href="SimpleSkin.html">SimpleSkin</a></li><li><a href="Skin.html">Skin</a></li><li><a href="Stroke.html">Stroke</a></li><li><a href="TCPReporter.html">TCPReporter</a></li><li><a href="TextActivityBase.html">TextActivityBase</a></li><li><a href="TextActivityBasePanel.html">TextActivityBasePanel</a></li><li><a href="TextActivityDocument.html">TextActivityDocument</a></li><li><a href="TextGrid.html">TextGrid</a></li><li><a href="TextGridContent.html">TextGridContent</a></li><li><a href="TextTarget.html">TextTarget</a></li><li><a href="Timer.html">Timer</a></li><li><a href="TriangularJigSaw.html">TriangularJigSaw</a></li><li><a href="Utils.html">Utils</a></li><li><a href="WordSearch.html">WordSearch</a></li><li><a href="WordSearchPanel.html">WordSearchPanel</a></li><li><a href="WrittenAnswer.html">WrittenAnswer</a></li><li><a href="WrittenAnswerPanel.html">WrittenAnswerPanel</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="externals.list.html" class="dropdown-toggle" data-toggle="dropdown">Externals<b class="caret"></b></a>
				<ul class="dropdown-menu inline">
					<li><a href="external-CanvasRenderingContext2D.html">CanvasRenderingContext2D</a></li><li><a href="external-Collator.html">Collator</a></li><li><a href="external-HTMLAudioElement.html">HTMLAudioElement</a></li><li><a href="external-HTMLElement.html">HTMLElement</a></li><li><a href="external-HTMLImageElement.html">HTMLImageElement</a></li><li><a href="external-i18next.html">i18next</a></li><li><a href="external-jQuery.html">jQuery</a></li><li><a href="external-jqXHR.html">jqXHR</a></li><li><a href="external-JSZip.html">JSZip</a></li><li><a href="external-MediaRecorder.html">MediaRecorder</a></li><li><a href="external-NamedNodeMap.html">NamedNodeMap</a></li><li><a href="external-Promise.html">Promise</a></li><li><a href="external-Storage.html">Storage</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			

		<h1 class="page-title">Source: automation/arith/Arith.js</h1>
    
<section>
    <article>
        <pre
            class="sunlight-highlight-javascript linenums">/**
 *  File    : automation/arith/Arith.js
 *  Created : 28/05/2015
 *  By      : Francesc Busquets &lt;francesc@gmail.com>
 *
 *  JClic.js
 *  An HTML5 player of JClic activities
 *  https://projectestac.github.io/jclic.js
 *
 *  @source https://github.com/projectestac/jclic.js
 *
 *  @license EUPL-1.1
 *  @licstart
 *  (c) 2000-2018 Catalan Educational Telematic Network (XTEC)
 *
 *  Licensed under the EUPL, Version 1.1 or -as soon they will be approved by
 *  the European Commission- subsequent versions of the EUPL (the "Licence");
 *  You may not use this work except in compliance with the Licence.
 *
 *  You may obtain a copy of the Licence at:
 *  https://joinup.ec.europa.eu/software/page/eupl
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the Licence is distributed on an "AS IS" basis, WITHOUT
 *  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 *  Licence for the specific language governing permissions and limitations
 *  under the Licence.
 *  @licend
 */

/* global define */

define([
  "jquery",
  "../AutoContentProvider",
  "../../Utils"
], function ($, AutoContentProvider, Utils) {

  //
  // Miscellaneous constants used by Arith:
  const
    NMAXLOOPS = 60,
    OPSTR = ['+', '-', String.fromCharCode(215), ':'],
    RES = -12345,
    // Special blank space
    S = String.fromCharCode(160)

  /**
   * Arith provides randomly generated mental arithmetics operations, ready to be used in JClic activities.
   *
   * The operations can be additions, subtractions, multiplications or divides. The unknown of these
   * operations can be the result of the operation (`A op B = ?`), any of the two operators
   * (`A op ? = C` or `? op B = C`) or also the operator itself (`A ? B = C`).
   * @exports Arith
   * @class
   * @extends AutoContentProvider
   */
  class Arith extends AutoContentProvider {
    /**
     * Arith constructor
     * @param {JClicProject} project - The JClic project to which this provider is related
     */
    constructor(project) {
      super(project)
      this.opA = new Arith.Operator()
      this.opB = new Arith.Operator()
    }

    /**
     * Formats the number with a fixed number of decimals, optionally filling the result with leading
     * zeroes to have a fixed number of digits.
     * @param {number} val - The value to format
     * @param {number} dec - Number of decimals
     * @param {number} pre - Minimal number of digits before dot.
     * @returns {String}
     */
    static DecFormat(val, dec, pre) {
      let result = val.toFixed(dec)
      if (pre) {
        let n = result.indexOf('.')
        if (n &lt; 0)
          n = result.length
        for (; n &lt; pre; n++)
          result = `0${result}`
      }
      return result
    }

    /**
     * Loads the object settings from a specific JQuery XML element
     * @override
     * @param {external:jQuery} $xml - The XML element to parse
     */
    setProperties($xml) {
      $xml.children().each((_n, child) => {
        const $node = $(child)
        let xNum = ''
        switch (child.nodeName) {
          case 'operand':
            switch ($node.attr('id')) {
              case 'A':
                this.opA.setProperties($node)
                break
              case 'B':
                this.opB.setProperties($node)
                break
            }
            break
          case 'operations':
            this.use_add = Utils.getBoolean($node.attr('plus'))
            this.use_subst = Utils.getBoolean($node.attr('minus'))
            this.use_mult = Utils.getBoolean($node.attr('multiply'))
            this.use_div = Utils.getBoolean($node.attr('divide'))
            break
          case 'unknown':
            this.exp_abx = Utils.getBoolean($node.attr('result'))
            this.exp_xbc = Utils.getBoolean($node.attr('first'))
            this.exp_axc = Utils.getBoolean($node.attr('last'))
            this.exp_axbc = Utils.getBoolean($node.attr('operand'))
            this.exp_caxb = Utils.getBoolean($node.attr('inverse'))
            break
          case 'result':
            xNum = $node.attr('from')
            this.resultLimInf = Utils.getNumber(xNum === 'x' ? 0 : xNum, this.resultLimInf)
            xNum = $node.attr('to')
            this.resultLimSup = Utils.getNumber(xNum === 'x' ? 0 : xNum, this.resultLimSup)
            this.resultCarry = Utils.getBoolean($node.attr('notCarry'), this.resultCarry)
            this.resultNoDup = !Utils.getBoolean($node.attr('duplicates'), !this.resultNoDup)
            let s = $node.attr('order')
            this.resultOrder = s === 'ascending' ? 'SORTASC' : s === 'descending' ? 'SORTDESC' : 'NOSORT'
            s = $node.attr('condition')
            this.opCond = s === 'firstBig' ? 'AGB' : s === 'lastBig' ? 'BGA' : 'INDIF'
            break
        }
      })
      return this
    }

    /**
     * Fills the `n` parameter (an {@link Arith.Num}) with a value in accordance with the
     * specifications of `op` (an {@link Arith.Operand}), between two limits.
     * @param {Arith.Num} n - The number
     * @param {Arith.Operator} op - The operator
     * @param {number} limInf2 - Lower limit
     * @param {number} limSup2 - Upper limit
     * @returns {boolean} - `true` if all was OK
     */
    genNum(n, op, limInf2, limSup2) {
      let solved = false
      n.c = op.numDec
      const exp = n.c === 0 ? 1 : n.c === 1 ? 10 : 100

      let ls = op.limSup
      if (limSup2 !== RES &amp;&amp; limSup2 &lt; ls)
        ls = limSup2
      let li = op.limInf
      if (limInf2 !== RES &amp;&amp; limInf2 > li)
        li = limInf2

      if (op.fromList > 0) {
        n.vf = op.lst[Math.floor(Math.random() * op.fromList)]
        solved = true
      }
      if (!solved) {
        const r = Math.floor(Math.random() * 100)
        if (op.wZero &amp;&amp; r &lt;= 10) {
          n.vf = 0
          solved = true
        } else if (op.wOne &amp;&amp; r > 10 &amp;&amp; r &lt;= 20) {
          n.vf = 1
          solved = true
        } else if (op.wMinusOne &amp;&amp; r > 20 &amp;&amp; r &lt;= 30) {
          n.vf = -1
          solved = true
        }
      }
      if (!solved) {
        if (li > ls) {
          const k = li
          li = ls
          ls = k
        }
        let rang = Math.floor(ls - li + 1)
        if (rang &lt; 0)
          rang = 1
        let v = (Math.floor(Math.random() * rang) + li) * exp
        if (exp > 1)
          v += Math.floor(Math.random() * exp)
        n.vf = v / exp
      }
      return true
    }

    /**
     * Fills the provided {@link Arith.Operator} with real values
     * @param {Arith.Operator} o - The operator to use to generate the operation
     * @returns {boolean} - `true` if all was OK
     */
    genOp(o) {
      let i, ri2, rs2, q, va, vb, bufa, bufb
      const
        ops = [],
        rlinf = this.resultLimInf,
        rlsup = this.resultLimSup

      let nops = 0
      if (this.use_add)
        ops[nops++] = 'SUM'
      if (this.use_subst)
        ops[nops++] = 'REST'
      if (this.use_mult)
        ops[nops++] = 'MULT'
      if (this.use_div)
        ops[nops++] = 'DIV'

      const op = ops[Math.floor(Math.random() * nops)]
      switch (op) {
        case 'SUM':
          for (i = 0; i &lt; NMAXLOOPS; i++) {
            this.genNum(o.numA, this.opA, this.RES, rlsup)
            ri2 = o.numA.vf &lt; rlinf ? rlinf - Math.floor(o.numA.vf) : this.RES
            rs2 = rlsup - Math.floor(o.numA.vf)
            switch (this.opCond) {
              case 'AGB':
                if (rs2 === this.RES || rs2 > o.numA.vf)
                  rs2 = Math.floor(o.numA.vf)
                break
              case 'BGA':
                if (ri2 === this.RES || ri2 &lt; o.numA.vf)
                  ri2 = Math.floor(o.numA.vf)
                break
            }
            this.genNum(o.numB, this.opB, ri2, rs2)
            o.numR.vf = o.numA.vf + o.numB.vf
            if (o.numR.vf >= rlinf &amp;&amp; o.numR.vf &lt;= rlsup)
              break
          }
          o.numR.c = o.numA.c > o.numB.c ? o.numA.c : o.numB.c
          o.op = 0
          if (this.resultCarry &amp;&amp; o.numA.vf > 0 &amp;&amp; o.numB.vf > 0) {
            q = o.numR.c === 2 ? 100 : o.numR.c === 1 ? 10 : 1

            bufa = Arith.DecFormat(Math.floor(o.numA.vf * q + 0.5), 0, 10).split('')
            bufb = Arith.DecFormat(Math.floor(o.numB.vf * q + 0.5), 0, 10).split('')
            for (i = 0; i &lt; 10; i++)
              if (bufa[i] !== '0' || bufb[i] !== '0')
                break
            for (; i &lt; 10; i++) {
              va = parseInt(bufa[i])
              vb = parseInt(bufb[i])
              if (va + vb &lt; 10)
                continue
              while (va + vb > 9) {
                if (va > vb)
                  va = va > 0 ? Math.floor(Math.random() * va) : 0
                else
                  vb = vb > 0 ? Math.floor(Math.random() * vb) : 0
              }
              bufa[i] = va.toFixed(0)
              bufb[i] = vb.toFixed(0)
            }

            o.numA.vf = parseInt(bufa.join('')) / q
            o.numB.vf = parseInt(bufb.join('')) / q
            o.numR.vf = Math.floor(o.numA.vf + o.numB.vf + 0.5) / q
          }
          break

        case 'REST':
          for (i = 0; i &lt; NMAXLOOPS; i++) {
            this.genNum(o.numA, this.opA, rlinf, this.RES)
            ri2 = o.numA.vf > rlsup ? Math.floor(o.numA.vf - rlsup) : this.RES
            rs2 = Math.floor(o.numA.vf - rlinf)
            switch (this.opCond) {
              case 'AGB':
                if (rs2 === this.RES || rs2 > o.numA.vf)
                  rs2 = Math.floor(o.numA.vf)
                break
              case 'BGA':
                if (ri2 === this.RES || ri2 &lt; o.numA.vf)
                  ri2 = Math.floor(o.numA.vf)
                break
            }
            this.genNum(o.numB, this.opB, ri2, rs2)
            o.numR.vf = o.numA.vf - o.numB.vf
            if (o.numR.vf >= rlinf &amp;&amp; o.numR.vf &lt;= rlsup)
              break
          }
          o.numR.c = o.numA.c > o.numB.c ? o.numA.c : o.numB.c
          o.op = 1
          if (this.resultCarry &amp;&amp; o.numA.vf > 0 &amp;&amp; o.numB.vf > 0 &amp;&amp; o.numA.vf >= o.numB.vf) {
            q = o.numR.c === 2 ? 100 : o.numR.c === 1 ? 10 : 1
            bufa = Arith.DecFormat(Math.floor(o.numA.vf * q + 0.5), 0, 10).split('')
            bufb = Arith.DecFormat(Math.floor(o.numB.vf * q + 0.5), 0, 10).split('')
            for (i = 0; i &lt; 10; i++)
              if (bufb[i] !== '0')
                break
            for (; i &lt; 10; i++) {
              va = parseInt(bufa[i])
              vb = parseInt(bufb[i])
              if (va >= vb)
                continue
              vb = va > 0 ? Math.floor(Math.random() * va) : 0
              bufb[i] = vb.toFixed(0)
            }

            o.numA.vf = parseInt(bufa.join('')) / q
            o.numB.vf = parseInt(bufb.join('')) / q
            o.numR.vf = Math.floor(o.numA.vf - o.numB.vf + 0.5) / q
          }
          break

        case 'MULT':
          for (i = 0; i &lt; NMAXLOOPS; i++) {
            this.genNum(o.numA, this.opA, this.RES, this.RES)
            ri2 = this.opB.limInf
            rs2 = this.opB.limSup
            switch (this.opCond) {
              case 'AGB':
                if (rs2 > o.numA.vf)
                  rs2 = Math.floor(o.numA.vf)
                break
              case 'BGA':
                if (ri2 &lt; o.numA.vf)
                  ri2 = Math.floor(o.numA.vf)
                break
            }
            this.genNum(o.numB, this.opB, ri2, rs2)
            o.numR.vf = o.numA.vf * o.numB.vf
            if (o.numR.vf >= rlinf &amp;&amp; o.numR.vf &lt;= rlsup)
              break
          }
          o.numR.c = o.numA.c + o.numB.c
          o.op = 2
          break

        case 'DIV':
          for (i = 0; i &lt; NMAXLOOPS; i++) {
            this.genNum(o.numA, this.opA, this.RES, this.RES)
            ri2 = this.opB.limInf
            rs2 = this.opB.limSup
            switch (this.opCond) {
              case 'AGB':
                if (rs2 > o.numA.vf)
                  rs2 = Math.floor(o.numA.vf)
                break
              case 'BGA':
                if (ri2 &lt; o.numA.vf)
                  ri2 = Math.floor(o.numA.vf)
                break
            }
            this.genNum(o.numB, this.opB, ri2, rs2)
            if (o.numB.vf !== 0 &amp;&amp;
              Math.abs(o.numA.vf) >= Math.abs(o.numB.vf) &amp;&amp;
              (o.numR.vf = o.numA.vf / o.numB.vf) >= rlinf &amp;&amp;
              o.numR.vf &lt;= rlsup)
              break
          }
          if (o.numB.vf === 0)
            o.numB.vf = 1
          o.numR.vf = o.numA.vf / o.numB.vf
          i = o.numA.c - o.numB.c
          q = Math.pow(10, i)
          o.numA.vf *= q
          o.numR.vf *= q
          o.numR.vf = Math.floor(o.numR.vf)
          o.numA.vf = o.numR.vf * o.numB.vf
          o.numA.vf /= q
          o.numR.vf /= q
          o.numR.c = i > 0 ? i : 0
          o.op = 3
          break

        default:
          return false
      }
      return true
    }

    /**
     * Fills the provided ActiveBagContentKit with randomly generated operations
     * @override
     * @param {AutoContentProvider.ActiveBagContentKit} kit - The composite object to be filled with data.
     * @returns {boolean} - `true` if all was OK
     */
    process(kit) {
      let nRows = kit.nRows,
        nCols = kit.nCols,
        content = kit.content, //Array of ActiveBagContent
        useIds = kit.useIds,
        i, j, k,
        o, op = [], // Array of Arith.Operacio
        tipus = [],
        numTipus, tipX,
        tipInv = this.exp_caxb,
        va = '', vb = '', vc = '', operator = '',
        stra = [], strb = [], strc = [],
        nColsB = nCols, nRowsB = nRows,
        nCells = nRows * nCols,
        ass = null

      if (nRows &lt;= 0 || nCols &lt;= 0 ||
        content === null || content.length &lt; 1 || content[0] === null)
        return false

      if (nCells &lt; 2)
        return false

      numTipus = 0
      if (this.exp_abx)
        tipus[numTipus++] = 'ABX'
      if (this.exp_axc)
        tipus[numTipus++] = 'AXC'
      if (this.exp_xbc)
        tipus[numTipus++] = 'XBC'
      if (this.exp_axbc)
        tipus[numTipus++] = 'AXBC'
      if (numTipus === 0)
        return false

      for (i = 0; i &lt; nCells; i++) {
        o = new Arith.Operacio()
        for (j = 0; j &lt; NMAXLOOPS; j++) {
          this.genOp(o)
          if (this.resultNoDup) {
            for (k = 0; k &lt; i; k++) {
              if (o.numR.vf === op[k].numR.vf)
                break
            }
            if (k === i)
              break
          } else
            break
        }
        op[i] = o
      }

      if (this.resultOrder !== 0) {
        for (i = nCells - 1; i > 0; i--) {
          for (j = 0; j &lt; i; j++) {
            if (this.resultOrder === 'SORTASC' &amp;&amp; op[j].numR.vf > op[j + 1].numR.vf ||
              this.resultOrder === 'SORTDESC' &amp;&amp; op[j].numR.vf &lt; op[j + 1].numR.vf) {
              // Switch values
              o = op[j]
              op[j] = op[j + 1]
              op[j + 1] = o
            }
          }
        }
      }

      for (i = 0; i &lt; nCells; i++) {
        tipX = tipus[Math.floor(Math.random() * numTipus)]
        va = Arith.DecFormat(op[i].numA.vf, op[0].numA.c)
        vb = Arith.DecFormat(op[i].numB.vf, op[0].numB.c)
        vc = Arith.DecFormat(op[i].numR.vf, op[0].numR.c)
        operator = OPSTR[op[i].op]

        if (tipInv)
          strc[i] = vc + S + "=" + S + va + S + operator + S + vb
        else
          strc[i] = va + S + operator + S + vb + S + "=" + S + vc

        switch (tipX) {
          case 'AXC':
            strb[i] = vb
            stra[i] = tipInv ? `${vc}${S}=${S}${va}${S}${operator}${S}?` : `${va}${S}${operator}${S}?${S}=${S}${vc}`
            break

          case 'XBC':
            strb[i] = va
            stra[i] = tipInv ? `${vc}${S}=${S}?${S}${operator}${S}${vb}` : `?${S}${operator}${S}${vb}${S}=${S}${vc}`
            break

          case 'AXBC':
            strb[i] = operator
            stra[i] = tipInv ? `${vc}${S}=${S}${va}${S}?${S}${vb}` : `${va}${S}?${S}${vb}${S}=${S}${vc}`
            break

          default:
            strb[i] = vc
            stra[i] = tipInv ? `?${S}=${S}${va}${S}${operator}${S}${vb}` : `${va}${S}${operator}${S}${vb}${S}=`
            break
        }
      }

      if (useIds) {
        ass = []
        let strbx = []
        k = 0
        for (i = 0; i &lt; nCells; i++) {
          for (j = 0; j &lt; k; j++)
            if (strb[i] === strbx[j])
              break
          if (j === k) {
            strbx[k] = strb[i]
            ass[i] = k
            k++
          } else
            ass[i] = j
        }

        strb = []
        for (i = 0; i &lt; k; i++)
          strb[i] = strbx[i]

        if (nRowsB * nColsB !== k) {
          let distH = false
          switch (k) {
            case 6:
              nRowsB = distH ? 2 : 3
              nColsB = distH ? 3 : 2
              break

            case 8:
              nRowsB = distH ? 2 : 4
              nColsB = distH ? 4 : 2
              break

            case 9:
              nRowsB = 3
              nColsB = 3
              break

            case 10:
              nRowsB = distH ? 2 : 5
              nColsB = distH ? 5 : 2
              break

            case 12:
              nRowsB = distH ? 3 : 4
              nColsB = distH ? 4 : 3
              break

            case 14:
              nRowsB = distH ? 2 : 7
              nColsB = distH ? 7 : 2
              break

            case 15:
              nRowsB = distH ? 3 : 5
              nColsB = distH ? 3 : 5
              break

            case 16:
              nRowsB = 4
              nColsB = 4
              break

            case 18:
              nRowsB = distH ? 6 : 3
              nColsB = distH ? 3 : 6
              break

            case 20:
              nRowsB = distH ? 4 : 5
              nColsB = distH ? 5 : 4
              break

            default:
              nRowsB = distH ? 1 : k
              nColsB = distH ? k : 1
              break
          }
        }
      }

      content[0].setTextContent(stra, nCols, nRows)
      if (ass !== null)
        content[0].setIds(ass)
      if (content.length > 1 &amp;&amp; content[1] !== null) {
        content[1].setTextContent(strb, nColsB, nRowsB)
        content[1].getShaper().reset(nColsB, nRowsB)
      }
      if (content.length > 2 &amp;&amp; content[2] !== null)
        content[2].setTextContent(strc, nCols, nRows)

      return true
    }
  }

  Object.assign(Arith.prototype, {
    //
    // Operations use two operators:
    /**
     * First operator
     * @name Arith#opA
     * @type {Arith.Operator} */
    opA: null,
    /**
     * Second operator
     * @name Arith#opB
     * @type {Arith.Operator} */
    opB: null,
    /**
     * Allow additions
     * @name Arith#use_add
     * @type {boolean} */
    use_add: true,
    /**
     * Allow subtractions
     * @name Arith#use_subst
     * @type {boolean} */
    use_subst: false,
    /**
     * Allow multiplications
     * @name Arith#use_mult
     * @type {boolean} */
    use_mult: false,
    /**
     * Allow divides
     * @name Arith#use_div
     * @type {boolean} */
    use_div: false,
    /**
     * Allow expressions of type `A op B = X`
     * @name Arith#exp_abx
     * @type {boolean} */
    exp_abx: true,
    /**
     * Allow expressions of type `A op X = C`
     * @name Arith#exp_axc
     * @type {boolean} */
    exp_axc: false,
    /**
     * Allow expressions of type `X op B = C`
     * @name Arith#exp_xbc
     * @type {boolean} */
    exp_xbc: false,
    /**
     * Allow expressions of type `A x B = C`
     * @name Arith#exp_axbc
     * @type {boolean} */
    exp_axbc: false,
    /**
     * Allow inverse expressions, like `C = A op B`
     * @name Arith#exp_caxb
     * @type {boolean} */
    exp_caxb: false,
    /**
     * Lower limit of the result
     * @name Arith#resultLimInf
     * @type {number} */
    resultLimInf: 0,
    /**
     * Upper limit of the result
     * @name Arith#resultLimSup
     * @type {number} */
    resultLimSup: 9999,
    /**
     * Allow carry operations
     * @see {@link https://en.wikipedia.org/wiki/Carry_(arithmetic)}
     * @name Arith#resultCarry
     * @type {boolean} */
    resultCarry: false,
    /**
     * Avoid operations with the same result
     * @name Arith#resultNoDup
     * @type {boolean} */
    resultNoDup: false,
    /**
     * Type of sorting of results. Possible values are: 'NOSORT', 'SORTASC' and 'SORTDESC'
     * @name Arith#resultOrder
     * @type {string} */
    resultOrder: 'NOSORT',
    /**
     * Sorting of the operands in commutative operations. Possible values are: 'AGB' (_A greater than B_),
     * 'BGA' (_B greater tan A_) and 'INDIF' (default)
     * @name Arith#opCond
     * @type {string} */
    opCond: 'INDIF',
  })

  /**
   * Operator is an Utility class used by Arith to encapsulate the properties and methods related
   * to the members of the operations.
   * @class
   */
  Arith.Operator = class {
    constructor() {
      this.limInf = 13
      this.limSup = 17
      this.lst = []
    }

    /**
     * Loads Arith.Operator settings from a specific JQuery XML element
     * @param {external:jQuery} $xml - The XML element to parse
     */
    setProperties($xml) {
      // Read attributes
      Utils.attrForEach($xml.get(0).attributes, (name, val) => {
        switch (name) {
          case 'decimals':
            this.numDec = Number(val)
            break

          case 'values':
            const values = val.split(' ')
            for (let i = 0; i &lt; values.length; i++)
              this.lst[i] = Number(values[i])
            this.fromList = this.lst.length
            break

          case 'from':
            this.limInf = Number(val === 'x' ? 0 : val)
            break

          case 'to':
            this.limSup = Number(val === 'x' ? 0 : val)
            break
        }

        $xml.children().each((_n, child) => {
          const $node = $(child)
          switch (child.nodeName) {
            case 'include':
              this.wZero = Utils.getBoolean($node.attr('zero'))
              this.wOne = Utils.getBoolean($node.attr('one'))
              this.wMinusOne = Utils.getBoolean($node.attr('minusOne'))
              break
          }
        })
      })
      return this
    }
  }

  Object.assign(Arith.Operator.prototype, {
    /**
     * Lower limit
     * @name Arith.Operator#limInf
     * @type {number} */
    limInf: 0,
    /**
     * Upper limit
     * @name Arith.Operator#limSup
     * @type {number} */
    limSup: 10,
    /**
     * Number of decimal places
     * @name Arith.Operator#numDec
     * @type {number} */
    numDec: 0,
    /**
     * Including 0
     * @name Arith.Operator#wZero
     * @type {boolean} */
    wZero: false,
    /**
     * Including 1
     * @name Arith.Operator#wOne
     * @type {boolean} */
    wOne: false,
    /**
     * Including -1
     * @name Arith.Operator#wMinusOne
     * @type {boolean} */
    wMinusOne: false,
    /**
     * Take values from list. This member stores the list length.
     * @name Arith.Operator#fromList
     * @type {number} */
    fromList: 0,
    /**
     * The list of possible values
     * @name Arith.Operator#lst
     * @type {number[]} */
    lst: [],
  })

  Arith.Num = class {
    constructor() {
      this.vf = 0.0 // The number value
      this.c = 0 // Number of decimals to be used when representing the number
    }

    format() {
      return Arith.DecFormat(this.vf, this.c)
    }
  }

  Arith.Operacio = class {
    constructor() {
      this.numA = new Arith.Num()
      this.numB = new Arith.Num()
      this.numR = new Arith.Num()
      this.op = 0
    }
  }

  // Register class in AutoContentProvider.CLASSES
  AutoContentProvider.CLASSES['@arith.Arith'] = Arith

  return Arith
})
</pre>
    </article>
</section>





		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>
